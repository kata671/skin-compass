<!doctype html>
<html lang="pl" data-lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Skin Compass — analiza, rekomendacje, gra, progres, planer</title>
  <meta name="description" content="Analiza zdjęcia (lokalnie), rekomendacje kosmetyczne, gra edukacyjna, planer rutyny, kapsuła before/after, blog, quizy. Edukacyjnie — bez porad medycznych." />
  <link rel="stylesheet" crossorigin href="/skin-compass/assets/index-irwu7pkw.css">
</head>
<body>
<header class="topbar">
  <div class="brand"><span class="dot"></span><b>Skin Compass</b></div>
  <nav class="nav">
    <a href="#analyzer">Analiza</a>
    <a href="#recs">Rekomendacje</a>
    <a href="#game">Gra</a>
    <a href="#quiz">Quiz</a>
    <a href="#progress">Progres</a>
    <a href="#planner">Planer</a>
    <a href="#blog">Blog</a>
    <a href="#legal">Prywatność</a>
  </nav>
  <div class="actions">
    <button class="btn small" id="langToggle">PL/EN</button>
    <button class="btn primary small" id="ctaStart">Zacznij</button>
  </div>
</header>

<main class="container">
  <!-- HERO -->
  <section class="hero" id="hero">
    <h1 data-t="h1">Wrzuć zdjęcie. Otrzymaj mądre rekomendacje.</h1>
    <p class="muted" data-t="heroSub">Wszystko działa lokalnie — zdjęcia zostają w Twojej przeglądarce. Edukacyjnie, bez porad medycznych.</p>
    <div class="hero-cards">
      <div class="card"><h3>Analiza zdjęcia</h3><p class="muted">Rozpoznanie kategorii + lista produktów.</p></div>
      <div class="card"><h3>Gra i quiz</h3><p class="muted">Ucz się dobierania składników i sprawdzaj wiedzę.</p></div>
      <div class="card"><h3>Plan i progres</h3><p class="muted">Planer rutyny + kapsuła before/after (localStorage).</p></div>
    </div>
  </section>

  <!-- ANALYZER + RECS -->
  <section class="grid-2" id="analyzer">
    <div class="card">
      <h2>Analiza zdjęcia (prywatnie)</h2>
      <label class="uploader">
        <input id="file" type="file" accept="image/*">
        <div>Przeciągnij i upuść / kliknij, aby wybrać</div>
      </label>
      <div id="preview" class="preview hide"><img id="img" alt="podgląd"></div>

      <div class="card soft">
        <div class="badge">Kategoria</div>
        <div id="detected" class="mt6">—</div>
        <small class="muted">Edukacyjnie — to nie jest porada medyczna.</small>
      </div>

      <div class="btn-row">
        <button class="btn" data-cond="tradzik">Trądzik</button>
        <button class="btn" data-cond="wagry">Wągry</button>
        <button class="btn" data-cond="sucha">Sucha skóra</button>
        <button class="btn" data-cond="przebarwienia">Przebarwienia</button>
        <button class="btn" id="clear">Wyczyść</button>
      </div>
    </div>

    <div class="card" id="recs">
      <h2>Najlepsze rekomendacje</h2>
      <p class="muted" id="hint">Wybierz kategorię lub wrzuć zdjęcie.</p>
      <div id="filters" class="filters hide">
        <select id="timeFilter">
          <option value="">Pora: dowolna</option>
          <option>rano</option><option>wieczór</option>
        </select>
        <select id="typeFilter">
          <option value="">Typ: dowolny</option>
          <option>żel</option><option>krem</option><option>tonik</option><option>serum</option>
        </select>
        <select id="priceFilter">
          <option value="">Cena: dowolna</option>
          <option value="budget">budżetowe</option>
          <option value="mid">średnia półka</option>
          <option value="pro">wyższa półka</option>
        </select>
      </div>
      <div id="list" class="list"></div>
    </div>
  </section>

  <!-- GAME -->
  <section class="card" id="game">
    <h2>Gra — „Dobierz składniki”</h2>
    <p class="muted">Cel: <b id="goalLabel">Trądzik</b>. Zaznacz 3 składniki. Im lepsze dopasowanie, tym więcej punktów.</p>
    <div class="game-grid">
      <div>
        <div class="badge">Składniki</div>
        <div id="pool" class="chips"></div>
      </div>
      <div>
        <div class="badge">Twój wybór (max 3)</div>
        <div id="picked" class="chips"></div>
        <button class="btn primary mt12" id="scoreBtn">Sprawdź wynik</button>
        <div id="scoreBox" class="mt12"></div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section class="card" id="quiz">
    <h2>Quiz — pielęgnacja i składniki</h2>
    <div id="quizBox" class="quiz"></div>
    <div class="btn-row">
      <button class="btn" id="nextQ">Następne pytanie</button>
      <button class="btn" id="resetQ">Restart</button>
      <div class="badge" id="quizScore">Wynik: 0/0</div>
    </div>
  </section>

  <!-- PROGRESS -->
  <section class="card" id="progress">
    <h2>Progres — kapsuła before/after</h2>
    <p class="muted">Dane i obrazy tylko lokalnie (URL w przeglądarce).</p>
    <form id="progressForm" class="progress-form">
      <input type="date" id="pDate" required />
      <input type="text" id="pNote" placeholder="Notatka (np. tydzień 1 — BHA śr/pt)" />
      <input type="file" id="pImg" accept="image/*" />
      <button class="btn">Dodaj</button>
    </form>
    <div class="table">
      <div class="tr head"><div>Data</div><div>Notatka</div><div>Zdjęcie</div><div></div></div>
      <div id="pRows"></div>
    </div>
    <div class="mt12">
      <button class="btn small" id="exportJson">Eksportuj JSON</button>
      <button class="btn small" id="importJsonBtn">Importuj JSON</button>
      <input id="importJson" type="file" accept="application/json" class="hide" />
    </div>
  </section>

  <!-- PLANNER -->
  <section class="card" id="planner">
    <h2>Planer rutyny</h2>
    <div class="planner">
      <div class="planner-row head"><div>Dzień</div><div>Rano</div><div>Wieczór</div></div>
      <div id="planRows"></div>
    </div>
    <div class="mt12"><button class="btn" id="resetPlan">Resetuj planer</button></div>
  </section>

  <!-- BLOG -->
  <section class="card" id="blog">
    <h2>Edukacja i wpisy</h2>
    <div class="blog-grid" id="blogGrid"></div>
  </section>

  <!-- LEGAL -->
  <section class="card" id="legal">
    <h2>Informacje prawne</h2>
    <details open>
      <summary>Oświadczenie</summary>
      <p class="muted small mt6">Aplikacja ma charakter edukacyjny. Nie jest poradą ani usługą medyczną. W razie potrzeby skonsultuj się z lekarzem.</p>
    </details>
    <details>
      <summary>Prywatność</summary>
      <ul class="muted small mt6">
        <li>Zdjęcia przetwarzane są wyłącznie lokalnie (brak wysyłki na serwer).</li>
        <li>Planer/progres zapisujemy w Twojej przeglądarce (localStorage).</li>
        <li>Możesz usunąć dane, czyszcząc pamięć przeglądarki.</li>
      </ul>
    </details>
    <details>
      <summary>Warunki korzystania</summary>
      <p class="muted small mt6">Korzystając z aplikacji, akceptujesz powyższe zasady.</p>
    </details>
  </section>
</main>

<!-- COOKIE / CONSENT -->
<div class="consent hide" id="consent">
  <div>Używamy localStorage wyłącznie do zapisu Twoich ustawień i progresu. Brak śledzenia.</div>
  <div><button class="btn primary small" id="consentOk">OK</button></div>
</div>

<script>
/* ====== I18N ====== */
const T={pl:{h1:"Wrzuć zdjęcie. Otrzymaj mądre rekomendacje.",heroSub:"Wszystko działa lokalnie — zdjęcia zostają w Twojej przeglądarce. Edukacyjnie, bez porad medycznych."},
         en:{h1:"Upload a photo. Get smart recommendations.",heroSub:"Everything runs locally — photos never leave your browser. Educational only, not medical advice."}};
document.getElementById('langToggle').onclick=()=>{
  const html=document.documentElement; html.dataset.lang=html.dataset.lang==='pl'?'en':'pl';
  const L=T[html.dataset.lang]; document.querySelector('[data-t="h1"]').textContent=L.h1; document.querySelector('[data-t="heroSub"]').textContent=L.heroSub;
};
document.getElementById('ctaStart').onclick=()=>document.getElementById('analyzer').scrollIntoView({behavior:'smooth'});
document.querySelectorAll('a[href^="#"]').forEach(a=>a.onclick=(e)=>{e.preventDefault();document.querySelector(a.getAttribute('href')).scrollIntoView({behavior:'smooth'})});

/* ====== DATA ====== */
const PRODUCTS={
  tradzik:[
    {name:"Acne Control Gel 2%", brand:"BX Labs", rating:4.7, price:"od 39 zł", time:"wieczór", type:"żel", tier:"budget", tags:["BHA","żel","noc"]},
    {name:"Kwas azelainowy 10%", brand:"Dr. AZE", rating:4.6, price:"od 49 zł", time:"rano", type:"serum", tier:"mid", tags:["azelainowy","przebarwienia"]}
  ],
  wagry:[
    {name:"Tonik BHA 2%", brand:"ClearWave", rating:4.6, price:"od 35 zł", time:"wieczór", type:"tonik", tier:"budget", tags:["pory","strefa-T"]}
  ],
  sucha:[
    {name:"Krem z ceramidami", brand:"BarrierLab", rating:4.8, price:"od 39 zł", time:"rano", type:"krem", tier:"mid", tags:["bariera"]}
  ],
  przebarwienia:[
    {name:"Serum z wit. C 15%", brand:"C-Glow", rating:4.5, price:"od 59 zł", time:"rano", type:"serum", tier:"mid", tags:["antyoksydant","rozświetlenie"]}
  ]
};
const LABELS={tradzik:"Trądzik",wagry:"Wągry / zaskórniki",sucha:"Sucha skóra",przebarwienia:"Przebarwienia"};

/* ====== ANALYZER + RECS ====== */
const fileInput=document.getElementById('file'), preview=document.getElementById('preview'), img=document.getElementById('img'),
      detected=document.getElementById('detected'), list=document.getElementById('list'), hint=document.getElementById('hint'),
      filters=document.getElementById('filters'), timeF=document.getElementById('timeFilter'), typeF=document.getElementById('typeFilter'), priceF=document.getElementById('priceFilter');
let currentKey=null;
function guessByName(n){n=n.toLowerCase();
  if(/acne|tradzik|pimple|pryszcz/.test(n))return"tradzik";
  if(/blackhead|wagry|comedone|pory/.test(n))return"wagry";
  if(/dry|sucha|xerosis|flaky/.test(n))return"sucha";
  if(/spot|dark|melasma|przebarw/.test(n))return"przebarwienia";
  return null;
}
function setCondition(k){ currentKey=k; detected.textContent=k?LABELS[k]:"—"; renderList(); }
function renderList(){
  list.innerHTML="";
  if(!currentKey){ hint.classList.remove('hide'); filters.classList.add('hide'); return; }
  hint.classList.add('hide'); filters.classList.remove('hide');
  (PRODUCTS[currentKey]||[])
    .filter(p=>!timeF.value||p.time===timeF.value)
    .filter(p=>!typeF.value||p.type===typeF.value)
    .filter(p=>!priceF.value||p.tier===priceF.value)
    .forEach(p=>{
      const el=document.createElement('div'); el.className='product';
      el.innerHTML=`<div class="dot"></div>
        <div><div><b>${p.name}</b></div>
        <div class="muted">${p.brand} • ⭐ ${p.rating.toFixed(1)} • ${p.price} • ${p.time} • ${p.type}</div>
        <div class="tags">${p.tags.map(t=>`<span class="badge">${t}</span>`).join(' ')}</div></div>`;
      list.appendChild(el);
    });
}
fileInput.onchange=(e)=>{ const f=e.target.files?.[0]; if(!f){preview.classList.add('hide');setCondition(null);return;}
  img.src=URL.createObjectURL(f); preview.classList.remove('hide'); setCondition(guessByName(f.name));
};
document.querySelectorAll('.btn[data-cond]').forEach(b=>b.onclick=()=>setCondition(b.dataset.cond));
document.getElementById('clear').onclick=()=>{fileInput.value="";preview.classList.add('hide');setCondition(null);};
[timeF,typeF,priceF].forEach(sel=>sel.onchange=renderList);

/* ====== GAME ====== */
const pool=document.getElementById('pool'), picked=document.getElementById('picked'), scoreBox=document.getElementById('scoreBox'), goalLabel=document.getElementById('goalLabel');
const ING=["BHA 2%","Retinoid","Niacynamid","Ceramidy","Kwas azelainowy","Wit. C","Kwas hialuronowy","Cynk","Bakuchiol","Peptydy"];
const MATCH={tradzik:["BHA 2%","Kwas azelainowy","Retinoid","Cynk","Niacynamid"],wagry:["BHA 2%","Niacynamid","Retinoid"],sucha:["Ceramidy","Kwas hialuronowy","Peptydy","Bakuchiol"],przebarwienia:["Wit. C","Kwas azelainowy","Retinoid","Niacynamid"]};
let targetKey='tradzik'; goalLabel.textContent=LABELS[targetKey]; let pickedSet=new Set();
function setGoalFromAnalyzer(){ if(currentKey){ targetKey=currentKey; goalLabel.textContent=LABELS[targetKey]; } }
function renderChips(){ pool.innerHTML=""; picked.innerHTML=""; ING.forEach(x=>{ const c=document.createElement('button'); c.className='chip'; c.textContent=x; c.onclick=()=>{ if(pickedSet.has(x)) pickedSet.delete(x); else if(pickedSet.size<3) pickedSet.add(x); drawPicked(); }; pool.appendChild(c); });}
function drawPicked(){ picked.innerHTML=""; [...pickedSet].forEach(x=>{ const c=document.createElement('button'); c.className='chip active'; c.textContent=x; c.onclick=()=>{pickedSet.delete(x); drawPicked();}; picked.appendChild(c); });}
document.getElementById('scoreBtn').onclick=()=>{ setGoalFromAnalyzer(); const target=new Set(MATCH[targetKey]||[]); let s=0; pickedSet.forEach(x=>{ s+= target.has(x)?50:-25; }); const msg=s>=100?"Świetnie! 🎉":"OK — warto poprawić wybór."; scoreBox.innerHTML=`<div class="score">Cel: <b>${LABELS[targetKey]}</b> • Wynik: <b>${s}</b> • ${msg}</div>`; };
renderChips();

/* ====== QUIZ ====== */
const Q=[ {q:"Co najlepiej na zaskórniki (wągry)?", a:["BHA 2%","Ceramidy","Kwas hialuronowy"], good:0, why:"BHA rozpuszcza sebum w porach i pomaga na zaskórniki."},
          {q:"Który składnik wspiera barierę skóry?", a:["Azelainowy","Ceramidy","Wit. C"], good:1, why:"Ceramidy odbudowują barierę hydrolipidową."},
          {q:"Na przebarwienia post-zapalne?", a:["Wit. C","Cynk","Kwas hialuronowy"], good:0, why:"Witamina C i azelainowy pomagają rozjaśniać przebarwienia."} ];
let qi=0, good=0, total=0;
const quizBox=document.getElementById('quizBox'), quizScore=document.getElementById('quizScore');
function renderQ(){ const item=Q[qi%Q.length]; quizBox.innerHTML=`<div class="q">${item.q}</div><div class="quiz-answers"></div><div id="why" class="muted mt6 small"></div>`; const box=quizBox.querySelector('.quiz-answers');
  item.a.forEach((txt,i)=>{ const b=document.createElement('button'); b.className='btn'; b.textContent=txt; b.onclick=()=>{ total++; if(i===item.good){ good++; b.classList.add('ok'); } else { b.classList.add('bad'); } quizBox.querySelectorAll('.btn').forEach(bb=>bb.disabled=true); document.getElementById('why').textContent=item.why; quizScore.textContent=`Wynik: ${good}/${total}`; }; box.appendChild(b); });
}
renderQ();
document.getElementById('nextQ').onclick=()=>{ qi++; renderQ(); };
document.getElementById('resetQ').onclick=()=>{ qi=0; good=0; total=0; quizScore.textContent="Wynik: 0/0"; renderQ(); };

/* ====== PROGRESS (localStorage + import/export) ====== */
const PKEY="skin-progress"; const pRows=document.getElementById('pRows'), pForm=document.getElementById('progressForm');
function loadP(){try{return JSON.parse(localStorage.getItem(PKEY)||"[]")}catch{return[]}}
function saveP(v){localStorage.setItem(PKEY,JSON.stringify(v))}
function renderP(){ pRows.innerHTML=""; loadP().forEach((r,i)=>{ const el=document.createElement('div'); el.className='tr';
  el.innerHTML=`<div>${r.d||""}</div><div>${r.n||""}</div><div>${r.u?`<img src="${r.u}" class="thumb">`:""}</div><div><button class="btn small" data-i="${i}">Usuń</button></div>`;
  pRows.appendChild(el); el.querySelector('button').onclick=()=>{ const all=loadP(); all.splice(i,1); saveP(all); renderP(); }; });}
function addP(obj){const all=loadP(); all.unshift(obj); saveP(all); renderP();}
pForm.onsubmit=e=>{e.preventDefault(); const d=document.getElementById('pDate').value; const n=document.getElementById('pNote').value; const f=document.getElementById('pImg').files?.[0];
  if(!d&&!n&&!f)return; if(f){ addP({d,n,u:URL.createObjectURL(f)});} else { addP({d,n}); } pForm.reset();};
renderP();
document.getElementById('exportJson').onclick=()=>{ const data=new Blob([JSON.stringify(loadP(),null,2)],{type:"application/json"}); const a=document.createElement('a'); a.href=URL.createObjectURL(data); a.download="skin-progress.json"; a.click(); };
document.getElementById('importJsonBtn').onclick=()=>document.getElementById('importJson').click();
document.getElementById('importJson').onchange=e=>{ const f=e.target.files?.[0]; if(!f)return; const r=new FileReader(); r.onload=()=>{ try{ const arr=JSON.parse(r.result); if(Array.isArray(arr)){ saveP(arr); renderP(); } }catch{} }; r.readAsText(f); };

/* ====== PLANNER (localStorage) ====== */
const DAYS=["Pon","Wt","Śr","Czw","Pt","Sob","Nd"], RKEY="skin-plan", planRows=document.getElementById('planRows');
function loadR(){try{return JSON.parse(localStorage.getItem(RKEY)||"{}")}catch{return{}}}
function saveR(v){localStorage.setItem(RKEY,JSON.stringify(v))}
function renderPlan(){ const data=loadR(); planRows.innerHTML=""; DAYS.forEach((d,i)=>{ const r=document.createElement('div'); r.className='planner-row';
  const am=data[i]?.am||"", pm=data[i]?.pm||""; r.innerHTML=`<div>${d}</div><div><input value="${am}" data-i="${i}" data-k="am" placeholder="np. SPF, tonik"/></div><div><input value="${pm}" data-i="${i}" data-k="pm" placeholder="np. retinoid, krem"/></div>`; planRows.appendChild(r); });
  planRows.querySelectorAll('input').forEach(inp=> inp.oninput=()=>{ const i=+inp.dataset.i, k=inp.dataset.k; const data=loadR(); data[i]=data[i]||{}; data[i][k]=inp.value; saveR(data); });
}
renderPlan(); document.getElementById('resetPlan').onclick=()=>{ localStorage.removeItem(RKEY); renderPlan(); };

/* ====== BLOG ====== */
const BLOG=[ {t:"BHA 2% — kiedy i jak?", s:"Zacznij od 2–3x w tygodniu, unikaj łączenia z retinoidem na start.", k:["BHA","peeling chemiczny"]},
             {t:"Bariera hydrolipidowa", s:"Ceramidy + cholesterole + kwasy tłuszczowe — szukaj w INCI: ceramide NP/NS.", k:["ceramidy","bariera"]},
             {t:"Azelainowy 10–15%", s:"Delikatny na przebarwienia i niedoskonałości. Działa wolniej, ale stabilnie.", k:["azelainowy","przebarwienia"]} ];
const blogGrid=document.getElementById('blogGrid'); BLOG.forEach(p=>{ const el=document.createElement('article'); el.className='card soft'; el.innerHTML=`<h3>${p.t}</h3><p class="muted">${p.s}</p><div class="tags">${p.k.map(x=>`<span class="badge">${x}</span>`).join(' ')}</div>`; blogGrid.appendChild(el);});

/* ====== CONSENT ====== */
const consent=document.getElementById('consent'); if(!localStorage.getItem('skin-consent')) consent.classList.remove('hide');
document.getElementById('consentOk').onclick=()=>{ localStorage.setItem('skin-consent','1'); consent.classList.add('hide'); };
</script>
</body>
</html>
